#include <stdio.h>
#include <string.h>
typedef unsigned char mac_addr[6];
typedef unsigned char inet6_addr[16];
mac_addr my_mac = {0x3c,0xaf,0x21,0x9e,0x5f,0x85};
mac_addr peer_mac = {0x3b,0xaf,0x21,0x9e,0x5f,0x85};
unsigned int crc32(unsigned char *data,int len) {
	unsigned int crc = 0xFFFFFFFF;
	for (int i=0;i<len;i++) {
		crc = crc ^ data[i];
		for (int j=7;j>=0;j--) {
			crc = (crc >> 1) ^ (0xEDB88320 & (-(crc & 1)));
		}
	}
	return ~crc;
}
unsigned short make_frame(mac_addr *dst,mac_addr *src,unsigned short protocol,unsigned char *payload,int payloadlen,unsigned char *result) {
	memcpy(&result[0],dst,6);
	memcpy(&result[6],src,6);
	memcpy(&result[12],&protocol,sizeof(protocol));
	memcpy(&result[14],payload,payloadlen);
	unsigned int crc32_result = crc32(result,payloadlen+14);
	memcpy(&result[14+payloadlen],&crc32_result,sizeof(crc32_result));
	return 18 + payloadlen;
}
void send_frame(unsigned char *frame_data,unsigned short len,FILE *file) {
	fwrite(&len,sizeof(len),1,file);
	fwrite(frame_data,sizeof(char),len,file);
}
unsigned char buf[1536];
unsigned char data[] = {0x60,0x0f,0x02,0xf4,0x00,0x3b,0x11,0x40,0x20,0x01,0x0d,0xa8,0xc8,0x00,0xad,0x08,0xe3,0xa9,0x18,0xfa,0x43,0x74,0x94,0x53,0x20,0x01,0x0d,0xa8,0xc8,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x33,0xc8,0x60,0x00,0x35,0x00,0x3b,0xbc,0xd5,0x9a,0x9e,0x01,0x00,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x14,0x6e,0x65,0x74,0x77,0x6f,0x72,0x6b,0x2d,0x70,0x72,0x6f,0x6a,0x65,0x63,0x74,0x2d,0x69,0x6e,0x66,0x6f,0x07,0x63,0x79,0x79,0x73,0x65,0x6c,0x66,0x04,0x6e,0x61,0x6d,0x65,0x00,0x00,0x10,0x00,0x01};
int main() {
	FILE *out = fopen("1.bin","w");
	unsigned short len;
	//send frame ok
	len = make_frame(&peer_mac,&my_mac,0xdd86,data,87,&buf[0]);
	send_frame(buf,len,out);
	//send frame crc error
	len = make_frame(&peer_mac,&my_mac,0xdd86,data,87,&buf[0]);
	buf[len-1] ^= 1;
	send_frame(buf,len,out);
	//send frame dst error
	len = make_frame(&my_mac,&my_mac,0xdd86,data,87,&buf[0]);
	send_frame(buf,len,out);
	fclose(out);
	return 0;
}